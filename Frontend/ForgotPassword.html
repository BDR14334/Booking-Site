<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <!-- For compatibility with older Internet Explorer browsers -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- Makes the layout responsive to screen size -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Boxicons icon library for UI icons -->
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />

    <!-- Link to external CSS file -->
    <link rel="stylesheet" href="style.css" />

    <title>Forgot Password</title>
</head>

<!-- Inline styling for background and paragraph text -->
<style>
    body {
        background: url("img/Background.jpg");   /* Background image */
        background-size: cover;                  /* Cover entire screen */
        background-repeat: no-repeat;            /* Prevent image repetition */
        background-attachment: fixed;            /* Keep image fixed while scrolling */
        overflow-y: auto;                        /* Allow vertical scroll */
    }

    p {
        margin-bottom: 20px;
        margin-top: -20px;
        color: rgba(255, 255, 255, 0.818);        /* Light white text */
    }
</style>

<body>
<div class="wrapper">
    <!-- Navigation bar -->
    <nav class="nav">
        <!-- Site logo -->
        <div class="nav-logo"><p>ZSP</p></div>

        <!-- Navigation links -->
        <div class="nav-menu" id="navMenu">
            <ul>
                <li><a href="Home.html" class="link">Home</a></li>
                <li><a href="About.html" class="link">About</a></li>
                <li><a href="Booking.html" class="link">Book</a></li>
                <li><a href="Contact.html" class="link">Contact</a></li>
            </ul>
        </div>

        <!-- Login button -->
        <div class="nav-button">
            <button class="btn white-btn" onclick="window.location.href='Login.html?view=login'">Login</button>
        </div>

        <!-- Mobile menu icon -->
        <div class="nav-menu-btn">
            <i class="bx bx-menu" onclick="myMenuFunction()"></i>
        </div>
    </nav>

    <!-- Form container -->
    <div class="form-box">
        <!-- Password reset form -->
        <div class="login-container" id="login">
            <div class="top">
                <header>Reset Password</header>
                <p>Enter your email and role to receive a password reset link.</p>
            </div>

            <!-- Dropdown to select user role -->
            <div class="input-box">
                <select class="input-field" id="loginRoleSelect" required>
                    <option value="" disabled selected>Select Role</option>
                    <option value="admin">Admin</option>
                    <option value="coach">Coach</option>
                    <option value="athlete">Athlete</option>
                </select>
                <i class="bx bx-user-check"></i>
            </div>

            <!-- Email input field -->
            <div class="input-box">
                <input type="email" class="input-field" id="resetEmail" placeholder="Email" required />
                <i class="bx bx-user"></i>
            </div>

            <!-- Submit button to send reset request -->
            <div class="input-box">
                <input type="submit" class="submit" id="resetBtn" value="Send Reset Link" />
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for menu toggle and sending password reset request -->
<script>
    // Function to toggle the mobile menu
    function myMenuFunction() {
        const i = document.getElementById("navMenu");
        i.className = i.className === "nav-menu" ? "nav-menu responsive" : "nav-menu";
    }

    // Runs when the DOM is fully loaded
    document.addEventListener("DOMContentLoaded", () => {
        // Event listener for reset button
        document.getElementById("resetBtn").addEventListener("click", async (e) => {
            e.preventDefault();  // Prevents default form submission

            // Get email and role values from form inputs
            const email = document.getElementById("resetEmail").value;
            const role = document.getElementById("loginRoleSelect").value;

            // Validate that both fields are filled
            if (!email || !role) {
                alert("Please provide both email and role.");
                return;
            }

            try {
                // Send POST request to backend with email and role
                const res = await fetch('http://localhost:5000/auth/forgot-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, role })
                });

                const data = await res.json();

                if (res.ok) {
                    // If successful, show confirmation (even if user not found, for security)
                    alert("Reset email sent if account exists.");
                } else {
                    // Display server-provided error or fallback message
                    alert(data.error || "Something went wrong.");
                }
            } catch (err) {
                // Catch network or server errors
                alert("Error sending reset link.");
                console.error(err);
            }
        });
    });
</script>
</body>
</html>

