
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="style.css" />
    <title>Login & Registration</title>
</head>
<style>
    body {
        background: url("img/GYM.jpg");
        background-size: cover;
        background-repeat: no-repeat;
        background-attachment: fixed;
        overflow-y: auto; /* Allows vertical scroll if needed */
    }
    .wrapper{
        background: rgba(39, 39, 39, 0.7);
    }
    
</style>

<body>
<div class="wrapper">
    <!-- Navigation bar -->
    <nav class="nav">
        <!-- Logo -->
        <div class="nav-logo"><p>ZSP</p></div>

        <!-- Navigation links -->
        <div class="nav-menu" id="navMenu">
            <ul>
                <li><a href="index.html" class="link">Home</a></li>
                <li><a href="About.html" class="link">About</a></li>
                <li><a href="Booking.html" class="link">Book</a></li>
                <li><a href="Contact.html" class="link">Contact</a></li>
            </ul>
        </div>

        <!-- Login/Register buttons -->
        <div class="nav-button" id="authButtons">
            <button class="btn white-btn" id="loginBtn" onclick="login()">Login</button>
            <button class="btn" id="registerBtn" onclick="register()">Register</button>
        </div>

        <!-- Hamburger icon for mobile nav -->
        <div class="nav-menu-btn">
          <i class="bx bx-menu" onclick="toggleMenuSidebar()"></i>
        </div>
    </nav>

    <div id="profileSidebar" class="sidebar bg-dark text-white">
      <button class="btn btn-sm btn-outline-light ms-2 mt-2 close-btn" onclick="toggleSidebar()">√ó Close</button>
      <div class="mt-4 d-flex flex-column">
        <p id="userRole" class="px-3 text-white"></p>
        <div id="sidebarLinksContainer"></div>
        <a href="#" id="logoutBtn" class="text-danger px-3 py-2 text-decoration-none" style="display:none;">üö™ Logout</a>
      </div>
    </div>

    <div id="menuSidebar" class="sidebar bg-dark text-white" style="left:0; right:auto;">
      <button class="btn btn-sm btn-outline-light ms-2 mt-2 close-btn" onclick="toggleMenuSidebar()">√ó Close</button>
      <h4 style="margin-left:1.5rem; color:#fff;">Menu</h4>
      <div class="mt-4 d-flex flex-column">
        <a href="index.html" class="text-white px-3 py-2 text-decoration-none">üè† Home</a>
        <a href="About.html" class="text-white px-3 py-2 text-decoration-none">‚ÑπÔ∏è About</a>
        <a href="Booking.html" class="text-white px-3 py-2 text-decoration-none">üìÖ Book</a>
        <a href="Contact.html" class="text-white px-3 py-2 text-decoration-none">‚úâÔ∏è Contact</a>
      </div>
    </div>

    <!-- Container for forms -->
    <div class="form-box">
        <!-- Login Form -->
        <div class="login-container active" id="login">
            <div class="top">
                <span>Don't have an account? <a href="#" onclick="register()">Register</a></span>
                <header>Login</header>
            </div>

            <!-- Login credentials -->
            <div class="input-box">
                <input type="text" class="input-field" id="loginIdentifier" placeholder="Username or Email">
                <i class="bx bx-user"></i>
            </div>

            <!-- Password field -->
            <div class="input-box">
                <input type="password" class="input-field" id="loginPassword" placeholder="Password">
                <i class="bx bx-lock-alt"></i>
            </div>

            <!-- Submit button -->
            <div class="input-box">
                <input type="submit" class="submit" value="Login">
            </div>

            <!-- Remember Me and Forgot Password -->
            <div class="two-col">
                <div class="one">
                    <input type="checkbox" id="login-check">
                    <label for="login-check"> Remember Me</label>
                </div>
                <div class="two">
                    <label><a href="ForgotPassword.html">Forgot password?</a></label>
                </div>
            </div>
        </div>

        <!-- Registration Form -->
        <div class="register-container" id="register">
            <div class="top">
                <span>Have an account? <a href="#" onclick="login()">Login</a></span>
                <header>Register</header>
            </div>

            <!-- Role selection dropdown -->
            <div class="input-box">
                <select class="input-field" id="registerRoleSelect">
                    <option value="" disabled selected>Select Role</option>
                    <option value="adult-athlete">Adult Athlete</option>
                    <option value="athlete">Parent/Guardian of Athlete</option>
                </select>
                <i class='bx bx-user-check'></i>
            </div>

            <!-- Admin ID field for admin registration -->
            <div class="input-box" id="registerAdminIdContainer" style="display: none;">
                <input type="password" class="input-field" id="registerAdminId" placeholder="Admin ID">
                <i class="bx bx-lock-alt"></i>
            </div>

            <!-- First and Last name inputs -->
            <div class="two-forms">
                <div class="input-box">
                    <input type="text" class="input-field" placeholder="First Name">
                    <i class="bx bx-user"></i>
                </div>
                <div class="input-box">
                    <input type="text" class="input-field" placeholder="Last Name">
                    <i class="bx bx-user"></i>
                </div>
            </div>

            <!-- Username input -->
            <div class="input-box">
              <input type="text" class="input-field" id="registerUsername" placeholder="Username" required>
              <i class="bx bx-user-circle"></i>
            </div>

            <!-- Email and password -->
            <div class="input-box">
                <input type="text" class="input-field" placeholder="Email">
                <i class="bx bx-envelope"></i>
            </div>

            <div class="input-box">
                <input type="password" class="input-field" placeholder="Password">
                <i class="bx bx-lock-alt"></i>
            </div>

            <!-- Submit button -->
            <div class="input-box">
                <input type="submit" class="submit" value="Register">
            </div>

            <!-- Remember Me and Terms -->
            <div class="two-col">
                <div class="one">
                    <input type="checkbox" id="register-check">
                    <label for="register-check"> Remember Me</label>
                </div>
                <div class="two">
                    <label><a href="#">Terms & conditions</a></label>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript logic -->
<script src="authStatus.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function showCustomAlert(message) {
        document.getElementById('customAlertMessage').innerText = message;
        document.getElementById('customAlertPopup').style.display = 'block';
    }

    function closeCustomAlertPopup() {
        document.getElementById('customAlertPopup').style.display = 'none';
    }

    document.addEventListener("DOMContentLoaded", async () => {
        const token = localStorage.getItem("token");
        if (token) {
            try {
            const res = await fetch(`${API_BASE}/auth/verify`, {
                method: "GET",
                headers: { "Authorization": `Bearer ${token}` },
                credentials: "include"
            });
            const data = await res.json();
            if (res.ok && data.user) {
                window.location.href = "index.html"; // Redirect to home if already logged in
                return;
            }
            } catch (err) {
            console.warn("Token invalid or expired.");
            }
        }

        // Not logged in ‚Üí show login form
        setTimeout(login, 0);
    });

    document.addEventListener("DOMContentLoaded", () => {
        // Register role-dependent input visibility
        const registerRoleSelect = document.getElementById("registerRoleSelect");
        const registerAdminIdContainer = document.getElementById("registerAdminIdContainer");

        registerRoleSelect.addEventListener("change", function () {
            registerAdminIdContainer.style.display = (this.value === "admin") ? "block" : "none";
        });

        // LOGIN form submission logic
        document.querySelector('#login .submit').addEventListener('click', async (e) => {
            e.preventDefault();

            const identifier = document.getElementById("loginIdentifier").value.trim();
            const password = document.getElementById("loginPassword").value.trim();

            const res = await fetch(`${API_BASE}/auth/login`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              credentials: 'include',
              body: JSON.stringify({ identifier, password })
            });

            const data = await res.json();
            if (res.ok) {
                const { user, token } = data;

                // ‚úÖ Store the token in localStorage for mobile compatibility
                localStorage.setItem("token", token);

                // Redirect based on user.role
                if (user.role === "adult-athlete") {
                    window.location.href = "AdultAthleteDashboard.html";
                } else if (user.role === "athlete") {
                    window.location.href = "AthleteDashboard.html";
                } else if (user.role === "coach") {
                    window.location.href = "CoachDashboard.html";
                } else if (user.role === "admin") {
                    window.location.href = "AdminDashboard.html";
                } else {
                    window.location.href = "index.html"; // fallback
                }
            } else {
                showCustomAlert(data.error || "Login failed.");
            }
        });


        // REGISTER form submission logic
        document.querySelector('#register .submit').addEventListener('click', async (e) => {
            e.preventDefault();

            // Gather form input values
            const first_name = document.querySelector('#register input[placeholder="First Name"]').value.trim();
            const last_name = document.querySelector('#register input[placeholder="Last Name"]').value.trim();
            const email = document.querySelector('#register input[placeholder="Email"]').value.trim();
            const password = document.querySelector('#register input[placeholder="Password"]').value;
            const role = document.getElementById("registerRoleSelect").value;
            const username = document.getElementById("registerUsername").value.trim();

            // Validate that the selected role is allowed
            const validRoles = ['adult-athlete', 'athlete'];
            if (!validRoles.includes(role)) {
                showCustomAlert("Please select a valid role.");
                return;
            }

            try {
                const body = { first_name, last_name, username, email, password, role };

                // Send registration request
                const res = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                const data = await res.json();
                if (res.ok) {
                    showCustomAlert("Registration successful! You can now log in.");
                    login(); // Switch to login form visually
                } else {
                    showCustomAlert(data.error || "Registration failed.");
                }
            } catch (err) {
                showCustomAlert("Error registering.");
                console.error(err);
            }
        });
    });

    // Switch to login form
    function login() {
        // Switch form
        document.getElementById("login").classList.add("active");
        document.getElementById("register").classList.remove("active");
        // Update navbar button styles
        const loginBtn = document.getElementById("loginBtn");
        const registerBtn = document.getElementById("registerBtn");
        if (loginBtn) loginBtn.classList.add("white-btn");
        if (registerBtn) registerBtn.classList.remove("white-btn");
    }

    function register() {
        // Switch form
        document.getElementById("login").classList.remove("active");
        document.getElementById("register").classList.add("active");
        // Update navbar button styles
        const loginBtn = document.getElementById("loginBtn");
        const registerBtn = document.getElementById("registerBtn");
        if (loginBtn) loginBtn.classList.remove("white-btn");
        if (registerBtn) registerBtn.classList.add("white-btn");
    }

    document.addEventListener("DOMContentLoaded", () => {
        if (window.location.search.includes("register")) {
            activeForm = "register";
            setTimeout(register, 0);
        } else {
            activeForm = "login";
            setTimeout(login, 0);
        }
    });

    function toggleMenuSidebar() {
      const sidebar = document.getElementById("menuSidebar");
      sidebar.style.display = sidebar.style.display === "block" ? "none" : "block";
    }

    // Update your hamburger icon to call this function:
    document.querySelector('.nav-menu-btn i').onclick = toggleMenuSidebar;

    // Hide sidebar when clicking outside
    document.addEventListener("click", function (event) {
      const menuSidebar = document.getElementById("menuSidebar");
      const menuBtn = document.querySelector('.nav-menu-btn i');
      if (
        menuSidebar.style.display === "block" &&
        !menuSidebar.contains(event.target) &&
        !(menuBtn && menuBtn.contains(event.target))
      ) {
        menuSidebar.style.display = "none";
      }
    });

    document.addEventListener("click", function (event) {
      const sidebar = document.getElementById("profileSidebar");
      const profileBtn = document.getElementById("profileBtn");
      if (sidebar.style.display === "block" &&
          !sidebar.contains(event.target) &&
          !(profileBtn && profileBtn.contains(event.target))) {
        sidebar.style.display = "none";
      }
    });
</script>
    <!-- Styled Alert Popup -->
    <div id="customAlertPopup" style="
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #343a40;
        color: white;
        padding: 25px 30px;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.4);
        z-index: 9999;
        font-size: 18px;
        text-align: center;
        max-width: 400px;
        ">
        <p id="customAlertMessage">Placeholder message</p>
        <button onclick="closeCustomAlertPopup()" style="
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #ff4800;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        ">OK</button>
    </div>

</body>
</html>

